<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" ><topic xml:lang="en-us" id="topic2128">
<title>Heat Stack Updates Take 30+ Minutes</title>
<titlealts>
<searchtitle>HPE Helion Openstack 1.1: Troubleshooting the Controller Nodes</searchtitle>
</titlealts>
<prolog>
<metadata>
<othermeta name="layout" content="default"/>
<othermeta name="product-version" content="HPE Helion Openstack"/>
<othermeta name="product-version" content="HPE Helion Openstack 1.1"/>
<othermeta name="role" content="Systems Administrator"/>
<othermeta name="role" content="Cloud Architect"/>
<othermeta name="role" content="Storage Administrator"/>
<othermeta name="role" content="Network Administrator"/>
<othermeta name="role" content="Service Developer"/>
<othermeta name="role" content="Cloud Administrator"/>
<othermeta name="role" content="Application Developer"/>
<othermeta name="role" content="Network Engineer"/>
<othermeta name="role" content="Paul F"/>
<othermeta name="product-version1" content="HPE Helion Openstack"/>
<othermeta name="product-version2" content="HPE Helion Openstack 1.1"/>
</metadata>
</prolog>
<body>
<p>
<!--PUBLISHED-->
 <!--./commercial/GA1/1.1commercial.troubleshooting.controller.md-->
 <!--permalink: /helion/openstack/1.1/services/troubleshooting/controller/--></p>
<!--



# HPE <tm tmtype="reg">Helion OpenStack</tm> 1.1: Troubleshooting the Controller Nodes

HPE <tm tmtype="reg">Helion OpenStack</tm> is an <tm tmtype="reg">OpenStack</tm> technology coupled with a version of Linux&#174; provided by HP. This topic describes all the known issues that you might encounter. To help you resolve these issues, we have provided possible solutions.

- [Heat Stack Updates Take 30+ Minutes](#foreverupdate)
-->
<!-- [After Updating, Cinder Create and Backups Fail](#failcinder)-->
<!-- ===================== horizontal rule ===================== -->
<p>
  <b>System Behavior/Message:</b>
</p>
<p>When <xref href="../../commercial/GA1/1.1commerical.services-remove-replace-failed-overcloud-nodes.dita" >Replacing a Failed Overcloud Controller</xref>, a Heat stack-update appears to be taking a long time (30 minutes or longer).</p>
<p>
  <b>Solution</b>
</p>
<p>Identify which resource is updating: From the seed, run following command to get an indication of which nodes to look at.</p>
<codeblock>
  <codeph>heat resource-list overcloud-ce-controller | grep -v -i complete
</codeph>
</codeblock>
<p>
  <b>View Logs</b>
</p>
<ol>
<li>
<p>On the controller node, look at the <codeph>/var/log/upstart/os-collect-config.log</codeph> for errors. Error messages for <codeph>os-refresh-config</codeph> are the most likely to indicate what the problem is.</p>

<ul>
<li>
<p>If the <codeph>waiting on os-svc-restart -n rabbitmq-server</codeph> message appears in the log then execute the following command.</p>

<p>sudo pkill -u rabbitmq
sudo rm -rf /mnt/state/var/lib/rabbitmq
sudo rm -rf /mnt/state/var/log/rabbitmq
sudo os-refresh-config
ironic port-create --address <required-cleanup remap="mac">
<ph> --node_uuid <required-cleanup remap="uuid">
<ph/>
</required-cleanup>
</ph>
</required-cleanup>
</p>
</li>
</ul>
<p>
<b>Note:</b> If you see the following error after runing<codeph>os-refresh-config</codeph>, re-run the command.</p>

<codeblock>
<codeph>ERROR: os-refresh-config:Could not lock /var/run/os-refresh-config.lock. [Errno 11] Resource temporarily unavailable.
</codeph>
</codeblock>

<ul>
<li>
<p>After adding back controller0, you see that controller1 is the only node in the cluster, and other nodes are taking a long time to join the cluster, run the following command on the controllers to show cluster status:</p>

<p>sudo rabbitmqctl cluster_status</p>
</li>
</ul>
<p>If the cluster name is not <codeph>controller0</codeph>, run the following command to add the node to the <codeph>controller0</codeph> cluster:</p>

<codeblock>
<codeph>sudo rabbitmqctl stop_app
sudo rabbitmqctl forget_cluster_node &lt;cluster node name&gt;
sudo rabbitmqctl start_app
sudo rabbitmqctl join_cluster_node &lt;controller0 clustername&gt;
sudo os-refresh-config
</codeph>
</codeblock>
</li>
<li>
<p>On the seed node, verify the logs in <codeph>/var/log/</codeph> directories, especially those in the <codeph>heat</codeph>, <codeph>nova</codeph> and <codeph>ironic</codeph> subdirectories respectively.</p>

<p>sudo tail -f /var/log/upstart/os-collect-config.log</p>
</li>
</ol>
<p> 
<xref href="#topic2128"> Return to Top </xref>
</p>
</body>
</topic>
