<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="jow1424723681500" xml:lang="en-us">
<!-- Modification History
        
-->
    <title id="51">Specifying a Page Size for a VM </title>
    <shortdesc id="52">You can request a specific page size for a VM by using a flavor with the required
        extra spec when you launch the VM, or by defining an image with the required metadata
        property.</shortdesc>
    <prolog>
        <author id="53">Jim Owens</author>
    </prolog>
    <taskbody>
        <prereq id="prereq_N10022_N1001F_N10001" id="61">
            <p id="62">Before you can request huge pages for a VM, you must define the
                available page sizes on the hosts in the cluster. For details, see <xref href="jow1423087781001.xml" id="63"/>.</p>
        </prereq>
        <context id="context_N1001F_N1001C_N10001" id="54">
            <p id="14">Memory required by a guest is allocated as one or more pages of the
                requested size. Once allocated, the memory is unavailable for use by other guests
                until the instance is terminated.</p>
            <p id="17">To add this extra spec to a flavor using the web administration
                interface, use the <uicontrol id="78">Memory Page Size</uicontrol> selection
                in the <uicontrol id="79">Create Flavor Extra Spec</uicontrol> drop-down
                menu. To access this menu, see <xref href="jow1429538642910.xml" id="80"/>.</p>
            <p id="18">You can also specify the extra spec from the CLI by setting the
                following parameter for a flavor:</p>
            <codeblock id="20"><userinput id="22">hw:mem_page_size=<varname id="23">pagesize</varname></userinput></codeblock>
            <p id="24">where <varname id="25">pagesize</varname> is one of the
                following:</p>
            <dl>
                <dlentry id="26">
                    <dt id="27">small</dt>
                    <dd id="28">
                        <p id="29">Requests the smallest available size on the compute
                            node.</p>
                    </dd>
                </dlentry>
                <dlentry id="30">
                    <dt id="31">large</dt>
                    <dd id="32">
                        <p id="33">Requests the largest available huge page size (1GiB, then
                            2MiB). <i id="70">This setting is not recommended</i> (see note).</p>
                    </dd>
                </dlentry>
                <dlentry id="34">
                    <dt id="35">any</dt>
                    <dd id="36">
                        <p id="37">Requests any available size, including smaller pages. The
                            actual size used depends on the compute driver implementation. For
                            HP Helion OpenStack Carrier Grade, the largest available size is used (1 GiB, then 2MiB,
                            then 4KiB). <i id="71">This setting is not recommended</i> (see note). </p>
                    </dd>
                </dlentry>
                <dlentry id="38">
                    <dt id="39">2048</dt>
                    <dd id="40">
                        <p id="41">Requests a 2MiB page.</p>
                    </dd>
                </dlentry>
                 <dlentry id="42">
                    <dt id="43">1048576</dt>
                    <dd id="44">
                        <p id="45">requests a 1GiB page.</p>
                    </dd>
                </dlentry> 
            </dl>
            <p id="64">If no page size is specified, small pages are used by default.</p>
            <note id="note_N100BD_N10032_N1001F_N10001" id="65">
                <p id="13">The use of <nameliteral id="72">large</nameliteral> or
                        <nameliteral id="73">any</nameliteral> is not recommended. These settings can cause
                    migration issues if the largest available size varies from host to host. For
                    reliable results, use <nameliteral id="74">small</nameliteral> <!-- for VMs that use shared
                    host memory resources,-->or a specific page size<!--for VMs that use dedicated host
                    resources-->.</p>
            </note>
            <p id="69"> </p>
            <p id="56">For example, to set a 2MiB page size on a flavor that has already
                been created, use the following command:</p>
            <codeblock id="57"><systemoutput id="58">~(keystone)admin)$ </systemoutput><userinput id="60">nova flavor-key hw:mem_page_size=2048</userinput></codeblock>
            <p id="15">You can also define an image with the required property by including
                the <parmname id="46">hw_mem_page_size</parmname> parameter, as in the
                following example:</p>
            <codeblock id="21"><systemoutput id="59">~(keystone)admin)$ </systemoutput><userinput id="48">nova image-meta <varname id="49">image</varname> hw_mem_page_size=<varname id="50">pagesize</varname></userinput></codeblock>
            <p id="55">Note that if you use image metadata to request a page size, the image
                is unable to access a <nameliteral id="75">large</nameliteral> page unless the setting for
                the flavor is also <nameliteral id="76">large</nameliteral> or
                    <nameliteral id="77">any</nameliteral>.</p>
        </context>
    </taskbody>
</task-wr>