<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task-wr PUBLIC "-//WindRiver.com//DTD DITA 1.2 Wind River General Task//EN" "task-wr.dtd">
<task-wr id="psa1428687672712" xml:lang="en-us">
<!-- Modification History
        
-->
    <title id="1">SR-IOV Ethernet Interfaces</title>
    <shortdesc id="2">A SR-IOV Ethernet interface is a physical PCI Ethernet NIC that
        implements hardware-based virtualization mechanisms to expose multiple virtual network
        interfaces that can be used by one or more virtual machines simultaneously.</shortdesc>
    <prolog>
        <author id="3">Pedro Sanchez</author>
    </prolog>
    <taskbody>
        <context id="context_N10022_N1001F_N10001" id="4">
            <p id="5">The PCI-SIG Single Root I/O Virtualization and Sharing (SR-IOV)
                specification defines a standardized mechanism to create individual virtual Ethernet
                devices from a single physical Ethernet interface. For each exposed virtual Ethernet
                device, formally referred to as a <term id="116">Virtual Function</term>
                (VF), the SR-IOV interface provides separate management memory space, work queues,
                interrupts resources, and DMA streams, while utilizing common resources behind the
                host interface. Each VF therefore has direct access to the hardware and can be
                considered to be an independent Ethernet interface.</p>
            <p id="118">When compared with a PCI Passthtrough Ethernet interface, a SR-IOV Ethernet
                interface:</p>
            <ul id="ul_tyq_ymg_rr">
                <li id="120">
                    <p id="122">Provides benefits similar to those of a PCI Passthtrough Ethernet interface,
                        including lower latency packet processing.</p>
                </li>
                <li id="124">
                    <p id="126">Scales up more easily in a virtualized environment by providing multiple VFs
                        that can be attached to multiple virtual machine interfaces.</p>
                </li>
                <li id="128">
                    <p id="130">Shares the same limitations, including the lack of support for LAG, QoS, ACS,
                        and live migration.</p>
                </li>
                <li id="30">
                    <p id="132">Has the same requirements regarding the VLAN configuration of
                        the access switches.</p>
                </li>
                <li id="134">
                    <p id="29">Provides a similar configuration workflow when used on HP Helion OpenStack Carrier Grade.</p>
                </li>
            </ul>
            <p id="136">It is suggested that you read <xref href="psa1413402160578.xml" id="138"/> first. Most configuration steps are similar, with the
                difference that you use <nameliteral id="140">pci-sriov</nameliteral>
                instead of <nameliteral id="141">pci-passthrough</nameliteral> when defining
                the network type of an interface.</p>
            <p id="142">In the following example a new virtual machine is launched by user
                    <nameliteral id="17">user1</nameliteral> on tenant <nameliteral id="18">tenant1</nameliteral>, with a VF interface connected to the
                tenant network <nameliteral id="19">tenant1-net1</nameliteral> identified
                with VLAN ID 20.</p>
        </context>
        <prereq id="prereq_N10065_N10020_N10001" id="117">
            <p id="119">The exercise assumes that the underlying provider network
                    <nameliteral id="121">group0-data0</nameliteral> exists already, and that
                VLAN ID 20 is a valid segmentation ID assigned to <nameliteral id="123">tenant1</nameliteral>.</p>
        </prereq>
        <steps>
            <step id="step_N10079_N10076_N10020_N10001" id="125">
                <cmd id="127">Log in as the <nameliteral id="129">admin</nameliteral>
                    user to the web management interface.</cmd>
            </step>
            <step id="step_N100BC_N100A9_N1001F_N10001" id="144">
                <cmd id="145">Lock the compute node you want to configure.</cmd>
            </step>
            <step id="step_N10086_N10076_N10020_N10001" id="131">
                <cmd id="135">Configure the Ethernet interface to be used as a SR-IOV
                    interface.</cmd>
                <info id="146">
                    <p id="147">Select the <wintitle id="133">System
                            Inventory</wintitle> window from the <uicontrol id="137">Admin</uicontrol> panel, click the <uicontrol id="139">Hosts</uicontrol> tab, click the name of the compute node where the PCI
                        interface is available, click the <uicontrol id="143">Interfaces</uicontrol> tab, and finally click the <uicontrol id="36">Edit Interface</uicontrol> button associated with the
                        interface you want to configure. Fill in the window as illustrated
                        below:</p>
                    <fig id="fig_hfk_cfh_rr" id="148">
                        <image href="psa1428767288855.image" id="image_zl3_ffh_rr" id="149" width="4in">
                            <alt id="150">TiS Edit SR-IOV Interface</alt>
                        </image>
                    </fig>
                    <p id="151">In this example, Ethernet interface <nameliteral id="42">eth8</nameliteral> is assigned the network type <term id="43">pci-sriov</term>, enabled to use 4 VFs, and configured as connected to
                        provider network <nameliteral id="44">group0-data0</nameliteral>.
                        Click the <uicontrol id="45">Save</uicontrol> button to proceed.</p>
                    <p id="162">The Maximum number of VFs displayed in this form is a read-only item which is
                        auto-discovered by the system by inspecting the specific NIC model. This
                        value is reported as 0 when the selected interface does not support
                        SR-IOV.</p>
                    <p id="46">The interface can also be configured from the CLI as
                        illustrated below:</p>
                    <codeblock id="108"><systemoutput id="111">~(keystone_admin)$ </systemoutput><userinput id="115">system host-if-modify \
-nt pci-sriov -N 4 -p group0-data0 compute-0 eth8</userinput></codeblock>
                </info>
            </step>
            <step id="step_N10080_N1007D_N1001F_N10001" id="6">
                <cmd id="7">Create the <nameliteral id="53">tenant1-net1</nameliteral> tenant network.</cmd>
                <info id="152">
                    <p id="153">You must ensure that:</p>
                    <ul id="ul_pcn_vb4_tp">
                        <li id="61">
                            <p id="62">The <nameliteral id="63">tenant1</nameliteral> tenant has access to the tenant network,
                                either assigning it as the owner, or by enabling the tenant
                                network's shared flag.</p>
                        </li>
                        <li id="64">
                            <p id="65">The segmentation ID is set to 20. </p>
                        </li>
                    </ul>
                </info>
            </step>
            <step id="step_N10160_N100A9_N1001F_N10001" id="154">
                <cmd id="155">Configure the access switch.</cmd>
                <info id="73">
                    <p id="104">Configure the physical port on the access switch used to
                        connect to Ethernet interface <nameliteral id="75">eth8</nameliteral> as an access port with default VLAN ID of 20.</p>
                </info>
            </step>
            <step id="step_N10178_N100A9_N1001F_N10001" id="156">
                <cmd id="157">Unlock the compute node.</cmd>
            </step>
            <step id="step_N10181_N100A9_N1001F_N10001" id="158">
                <cmd id="159">Launch the virtual machine.</cmd>
                <substeps id="substeps_snp_klt_tp">
                    <substep id="79">
                        <cmd id="80">Log in as user <nameliteral id="81">user1</nameliteral> to the web management interface.</cmd>
                    </substep>
                    <substep id="82">
                        <cmd id="83">Configure the network interfaces for the new virtual
                            machine.</cmd>
                        <info id="84">
                            <p id="85">Open the <wintitle id="86">Launch
                                    Instance</wintitle> dialog by clicking the <uicontrol id="87">Launch Interface</uicontrol> button on the
                                    <wintitle id="88">Instances</wintitle> window. Configure
                                the necessary options for the new virtual machine. In particular,
                                click the <uicontrol id="89">Networking</uicontrol> tab and
                                add a SR-IOV interface on the tenant network <nameliteral id="90">tenant1-net1</nameliteral>, as illustrated
                                below. Add other network interfaces as needed, there are as many
                                SR-IOV ports available as VFs have been enabled.</p>
                            <fig id="fig_yxy_t1g_tp" id="91">
                                <image href="psa1428773859042.image" id="image_g4g_b4h_rr" id="160">
                                    <alt id="161">TiS Assign SR-IOV interface</alt>
                                </image>
                            </fig>
                            <p id="95">Click the <uicontrol id="96">Launch</uicontrol> button to proceed.</p>
                            <p id="97">SR-IOV interfaces can be attached from the CLI when
                                booting a new virtual machine, as illustrated below:</p>
                            <codeblock id="98"><systemoutput id="114">~(keystone_admin)$ </systemoutput><userinput id="100">nova boot \
--nic net-id=704e9f3b,vif-model=pci-sriov my-new-vm</userinput></codeblock>
                        </info>
                    </substep>
                </substeps>
            </step>
        </steps>
        <result id="result_N101C1_N10020_N10001" id="101">
            <p id="102">The new virtual machine instance is up now. It has a SR-IOV VF
                connection to the <nameliteral id="103">tenant1-net1</nameliteral> tenant
                network identified with VLAN ID 20.</p>
        </result>
    </taskbody>
</task-wr>