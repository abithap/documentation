<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" ><topic xml:lang="en-us" id="topic5600">
<title>HPE Helion OpenStack(R) Carrier Grade (Beta): Deploying the Routing Scenario</title>
<prolog>
<metadata>
<othermeta name="layout" content="default"/>
<othermeta name="product-version" content="HPE Helion OpenStack(R)"/>
<othermeta name="product-version" content="HPE Helion OpenStack(R) 1.1"/>
<othermeta name="role" content="All"/>
<othermeta name="role" content="Paul F"/>
<othermeta name="product-version1" content="HPE Helion OpenStack(R)"/>
<othermeta name="product-version2" content="HPE Helion OpenStack(R) 1.1"/>
</metadata>
</prolog>
<body>
<p>
<!--UNDER REVISION-->
 <!--./CarrierGrade/DeploymentScenarios/carrier-grade-deployment-routing-deploy.md-->
 <!--permalink: /helion/openstack/carrier/deploy/routing/deploy/--></p>
<p>The Routing Scenario uses two virtual machines, each configured to route traffic between two network interfaces.</p>
<!-- ===================== horizontal rule ===================== -->
<p>
<b>Note:</b> This feature applies only to servers in the VNF Region.</p>
<!-- ===================== horizontal rule ===================== -->
<p>To complete the Deployment Scenarios configuration, you must perform the tasks in this section while logged in as user1, and then perform the same tasks while logged in as user2, substituting appropriate strings for instance names, keypairs, tenant networks, or other resources.</p>
<p>Each user must configure a virtual machine and launch an instance of a Layer 3 router. The router connects two VM interfaces; one is attached to the private
tenant network used for test equipment access (tenant1-net or tenant2-net), and the other is attached to internal-net to complete the test path.</p>
<ol>
<li>
<p>
<xref href="../../CarrierGrade/AdminGuideNew/Dashboard/carrier-grade.dashboard.launch.dita" >Launch the HPE Helion OpenStack(R) Horizon Dashboard</xref> as the appropriate user (user1 or user2).</p>
</li>
<li>
<p>Click the <b>Project</b> dashboard, then the <b>System</b> panel, then the <b>Overview</b> link.</p>
</li>
<li>
<p>Select <b>Instances</b> in the <b>Manage Compute</b> section of the <b>Project</b> tab to open the <b>Instances</b> page.</p>

<p>Since no instances are currently running, an empty list is displayed.</p>
</li>
<li>
<p>Configure the virtual machine details by clicking <b>Launch Instance</b> to display the Launch Instance window. Fill in the information in the Details tab, as illustrated below:</p>

<p>
<image href="../../media/CGH-deploy-routing-launch.png"/>
</p>

<p>In this example you are configuring an instance named tenant1-vm, with the flavor example-guest.small, booting from the volume named <codeph>volexample-guest</codeph>.</p>
</li>
<li>
<p>Configure the virtual machine authentication credentials.</p>

<p>In the <b>Launch Instance</b> window, select the Access &amp; Security tab and associate the available tenant's keypair with this instance. Use a suitable password ( tenant1 in this example) for administration.</p>
</li>
<li>
<p>Connect the VM to the required tenant networks.</p>

<p>All tenant networks accessible to the tenant are available for use by the virtual machine. You can use the <b>Networking</b> tab of the <b>Launch Instance</b> dialog box to connect the VM to a tenant network, by moving the network from the <b>Available Networks</b> list to the <b>Selected Networks</b> list . This connects the tenant network to a virtual ethernet interface ethn on the VM, where <codeph>n</codeph> is the next available integer starting from zero.</p>

<p>a. List the available tenant networks.</p>

<p>In the <b>Launch Instance</b> window, select the <b>Networking</b> tab. This displays the available networks at the bottom, and the currently selected networks at the top.</p>

<p>b. Connect the required tenant networks.</p>

<p>Click the blue + buttons on the Available Networks list to move the tenant networks to the Selected Networks list, as illustrated below.</p>

<p>
<image href="../../media/CGH-deploy-routing-launch-after.png"/>
</p>

<p>
<b>Note:</b> The order in which the networks are moved determines the order in which the virtual ethernet interfaces eth0, eth1, eth2, and so on are assigned. In the scenarios, the example guest image is configured to bridge or route between eth1 and eth2. The networks to be attached to the bridge or router must be moved in the proper order for compatibility with this configuration.</p>

<p>First, move the tenant1-mgmt-net network. This connects it to interface eth0 on the virtual machine. Then move tenant1-net and internal-net, in that order, to assign them to eth1 and eth2 on the virtual machine.</p>

<p>For each interface, you can specify the driver type from a drop-down menu. In this example, eth0 (NIC-1) is configured as a virtio interface, suitable for low-level management traffic. The eth1 (NIC-2) and eth2 (NIC-3) interfaces are configured as accelerated AVP ports for highthroughput traffic. You can select any other combination, as required by your application.</p>

<p>Once the three network interfaces have been selected, the Networking tab appears as follows:</p>

<p>
<image href="../../media/CGH-deploy-bridge-launch-nic.png"/>
</p>

<p>
<b>Note:</b> The interface type and allocated NIC order cannot be changed after the instance is launched. To use different port assignments, you must shut down and delete the instance, and then launch a new instance.</p>
</li>
<li>
<p>Implement a function on the guest image.</p>

<p>You can implement a function on a guest image by applying user data.</p>

<p>In the <b>Launch Instance</b> window, select the <b>Post-Creation</b> tab and populate the Customization Script text box with the appropriate user data.</p>

<p>Caution: The first line in the user data is a mandatory comment. Without it, the user data is ignored, and all network interfaces are initialized using DHCP.</p>

<ul>
<li>
<p>To implement a Linux router on the guest image, add user data to tenant1 and tenant2 as follows.</p>

<p>
<b>For tenant1:</b>
</p>

<codeblock>
<codeph>#wrs-config
FUNCTIONS="routing"
ADDRESSES=(
"172.31.1.1,255.255.255.0,eth1,1500"
"10.1.1.1,255.255.255.0,eth2.5,1500"
)
ROUTES=(
"10.160.2.0/24,172.31.1.2,eth1"
"10.170.2.0/24,10.1.1.2,eth2.5"
)
</codeph>
</codeblock>

<p>
<b>For tenant2:</b>
</p>

<codeblock>
<codeph>#wrs-config
FUNCTIONS="routing"
ADDRESSES=(
"172.31.2.1,255.255.255.0,eth1,1500"
"10.1.2.1,255.255.255.0,eth2.5,1500"
)
ROUTES=(
"10.170.2.0/24,172.31.2.2,eth1"
"10.160.2.0/24,10.1.1.1,eth2.5"
)
</codeph>
</codeblock>
</li>
</ul>
</li>
<li>
<p>Launch the instance.</p>

<p>In the Launch Instance window, click Launch to create the instance.</p>
</li>
</ol>
<p>The Routing Scenario is now running.</p>
<p>The updated Network Topology page for user1 appears as shown:</p>
<p>
  <image href="../../media/CGH-deploy-bridge-user1.png"/>
</p>
<p>The updated Network Topology page for user2 appears as shown:</p>
<p>
  <image href="../../media/CGH-deploy-bridge-user2.png"/>
</p>
<p>Once the virtual machines for both tenant users are running, you can run test traffic through the test path. For more information, see <xref href="../../CarrierGrade/DeploymentScenarios/carrier-grade-deployment-running-traffic.dita" >Running Traffic Through the Test Paths</xref>.</p>
<p>
  <xref type="section" href="#topic5600/top"> Return to Top </xref>
</p>
<!-- ===================== horizontal rule ===================== -->
</body>
</topic>
