<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "http://docs.oasis-open.org/dita/v1.1/OS/dtd/topic.dtd" >
<topic xml:lang="en-us" id="topic10581">
  <title>HPE Helion <tm tmtype="reg">OpenStack</tm> Carrier Grade 2.0 Beta: Configuring the Backup
    and Restore Location </title>
  <prolog>
    <metadata>
      <othermeta name="layout" content="default"/>
      <othermeta name="product-version" content="HPE Helion Openstack Carreir Grade 1.1"/>
      <othermeta name="role" content="Storage Administrator"/>
      <othermeta name="role" content="Storage Architect"/>
      <othermeta name="role" content="Michael B"/>
      <othermeta name="product-version1" content="HPE Helion Openstack Carreir Grade 1.1"/>
    </metadata>
  </prolog>
  <body>
    <!-- https://wiki.hpcloud.net/pages/viewpage.action?pageId=53513771 -->
    <p><!--Here is the wiki link for Attis. <xref href="https://rndwiki.corp.hpecorp.net/confluence/pages/viewpage.action?pageId=946944841" format="html" scope="external">https://rndwiki.corp.hpecorp.net/confluence/pages/viewpage.action?pageId=946944841</xref> 
The high level design needs to be adjusted to more suite with CG(It is reflecting CS in some areas)I will soon update it. 
But the CLI, REST API etc should all be same --></p>
    <p>HPE Helion OpenStack Carrier Grade implements backup and restore as a service (BRAAS) using
      the <b>attis</b> service, which you can use to backup and restore essential system files and
      components of the non-KVM cloud. The attis service is automatically installed on each of the
      controller nodes in the non-KVM region. Attis uses a command line interface. For more
      information, see <xref href="#topic10581" format="dita">Backup and Restore CLI</xref>.</p>
    <p>Before you start your first backup, you must use the attis CLI to specify where HPE Helion
      OpenStack Carrier Grade will store backup files. </p>
    <p>You can store backup files using: </p>
    <p>
      <ul id="ul_skz_ylx_pt">
        <li>SCP: A location on a remote server where the backup file is secure copied. </li>
        <li>NFS: A location on a network file system. </li>
        <li>FILE: A location on the Management appliance. </li>
      </ul>
    </p>
    <p>HPE recommends that you configure CloudSystem to use an SCP or NFS server so that backup files
      are automatically moved to an off-appliance location in case of a catastrophic failure of the
      Management appliance trio. You can use the FILE option if you want to manually mount shared
      storage on all three nodes of the Management appliance. </p>
    <p>IMPORTANT: If you do not set a storage location, the backup will not succeed. In the backup
      job list, you will see that SSH connection to the storage path failed, and the state is
      Failed. </p>
    <section><title>Set the location where the backup file is stored </title>Perform the following
      steps on any node of the Management appliance trio. For information about the attis CLI, see
      the <xref href="CGH-2--backup-restore-cli.dita#topic10581">Backup and Restore CLI</xref>. <ol
        id="ol_mnv_3mx_pt">
        <li>From the management hypervisor console underlying the CloudSystem Management appliance,
          SSH to the any node of the Management appliance trio (for example, ma1). </li>
        <li>Log in to the Management appliance using the cloudadmin credentials you set during
          First-Time Installation. </li>
        <li>Switch to the root user by running sudo â€“i. </li>
        <li>Set the type of backup storage location. <ul id="ul_nxl_kmx_pt">
            <li>To set the backup storage location to an SCP server, run: attis storage --use SCP </li>
            <li>To set the backup storage location to an NFS server, run: attis storage --use NFS </li></ul></li>
            <li>List the storage details.
          <codeblock>root@ma1:~# attis storage
+--------------------------------------+------+----------+ 
| id                                   |type  |selected  |
+--------------------------------------+------+----------+ 
|529cd8fb-c6a2-401d-9caf-61caeede7f81  |FILE  |False     |   
|d6210603-01b1-4d76-9068-e3ffa44a449e  |NFS   |False     | 
|7abb6f30-3f10-4918-9f8d-a58b157d59b9  |SCP   |True      |
+--------------------------------------+------+----------+ </codeblock></li>
              <li>View the storage parameters that you will need to update by selecting the storage
          ID of the selected type. Example:
          <codeblock>root@ma1:~# attis storage --id 7abb6f30-3f10-4918-9f8d-a58b157d59b9
+--------------------------------------+------+----------+ 
| id                                   |type  |selected  |
+--------------------------------------+------+----------+ 
|7abb6f30-3f10-4918-9f8d-a58b157d59b9  |SCP   |True      |
+--------------------------------------+------+----------+
+--------------------------------+--------------------------------------+---------+ 
|id           |storage_id        | parameter_name               | value           |
+---------------+----------------+----------------------+-------------------------+
| 18bb9b5e-&lt;...>| 7abb6f30-&lt;...> | user                 |                         | 
| 78aaa60e-&lt;...>| 7abb6f30-&lt;...> | storage_path         |                         | 
| c0a5c549-&lt;...>| 7abb6f30-&lt;...> | server               |                         |
| e34ac1b2-&lt;...>| 7abb6f30-&lt;...> | private_key_filepath | /home/attis/.ssh/id_rsa |
+---------------+----------------+----------------------+-------------------------+</codeblock></li>
              <li> Set the attis configuration of the storage type you entered in step 4 by
          entering:
            <codeblock>attis storage --update '{"parameter":"new value", "parameter":"new value"}' --id &lt;storage_id from the table> </codeblock><p>where
            parameter in an SCP configuration is:</p><ul>
            <li>user: User to SSH into the remote SCP server.</li>
            <li>storage_path: Path on the remote SCP server where you want to store backup
              files.</li>
            <li>server: IP address or DNS resolvable hostname of the remote server. </li>
            <li>private_key_filepath: Private key used to SSH to the remote SCP server. By default
              /home/attis/.ssh/id_rsa on MA is prepopulated. <p>SCP Example: To specify the details
                of an SCP server to use for backup file storage:
                </p><codeblock>attis storage --update '{"storage_path":"/mybackupDirOnRemoteMachine","private_key_filepath":"/home/attis/.ssh/is_rsa","server":"hostofscplocation","user":"remotescpuser"}' </codeblock><p>NFS
                Example To specify the details of an NFS server to use for backup file storage: </p><p>
                <codeblock>attis storage --update '{"server":"NFS server ip", "client_mount_path": "name of storage mount on management appliance", "storage_path":"mybackupDironRemoteMachine"}' --id &lt;copy the storage_id from attis storage></codeblock>
              </p><p>IMPORTANT: If you select SCP, you must copy the public key text located at
                /home/attis/.ssh/id_rsa.pub on each node of the Management appliance trio (ma1, ma2,
                and ma3) and paste it into the authorized_keys file of the SCP server. </p><p>If you
                want to generate a new key for setting up trust between attis and the SCP server,
                copy the private key to each Management appliance node. Then use the attis command
                storage --update to update the private_key_filepath.</p></li>
          </ul></li> 
              <li>Stop and restart the attis-server on all three nodes of the
              Management appliance (ma1, ma2, ma3). stop attis-server status attis-server Make sure
              that attis-server has stopped, then enter: start attis-server</li>
      </ol></section></body>
</topic>
