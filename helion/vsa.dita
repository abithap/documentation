<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_hjr_4x1_dt">
  <title>Install and Configure VSA (Optional)</title>
  <body>
    <section id="prereqs"><title>Pre-requisites</title>
      <p>In order to install and configure VSA you must have the following conditions met:</p>
      <ul>
        <li>Helion OpenStack 2.0 Cloud must be setup with: <ul>
            <li>Three VSA nodes according to specifications outlined in the <xref
                href="hardware.dita">Minimum Hardware Requirements</xref></li>
          </ul>
        </li>
        <li>Have the VSA node IP information from the
            <codeph>~/scratch/cp/my_cloud/stage/info/net_info.yml</codeph> file, which is generated
          by the configuration processor.</li>
      </ul></section>
    <section id="VSA"><title>Install and Configure VSA</title>
      <p>You can set up Virtual Storage Appliance (VSA) using the following instructions:</p>
      <ol>
        <li>Deploy VSA by running the following command: <ol>
            <li><codeblock>ansible-playbook -i hosts/verb_hosts vsa-deploy.yml</codeblock></li>
          </ol>
        </li>
        <li>Deploy CMC by running the following command: <ol>
            <li><codeblock>a.	ansible-playbook -i hosts/verb_hosts cmc-deploy.yml</codeblock></li>
          </ol>
        </li>
        <li>Set your X display and launch CMC: <ol>
            <li>Install Xming on a Windows machine that you can reach the deployer node on</li>
            <li>Enable X11 forwarding on PuTTy session for deployer node</li>
            <li>ssh -X to the first control plane node</li>
            <li>execute /opt/HP/StoreVirtual/UI/jre/bin/java-jar /opt/HP/StoreVirtual/UI/UI.jar
                <note>At this point the CMC UI should launch successfully</note></li>
          </ol>
        </li>
        <li>Create a Cluster using CMC: <ol>
            <li>Choose <codeph>Find -> Find Systems</codeph>, click <codeph>Add</codeph> and enter
              the IP addresses of the VSA virtual machinees</li>
            <li>Choose <codeph>Tasks -> Management Group -> New Management Group</codeph></li>
            <li>Enter the name for the management group, for example:
              <codeph>hlm003-vsa.mg</codeph></li>
            <li>Enter the username and password, for example: <codeph>stack / stack</codeph></li>
            <li>Add the NTP server(s) information</li>
            <li>Skip the DNS and SMTP sections</li>
            <li>Add the cluster name, for example: <codeph>hlm003-vsa-cluster</codeph></li>
            <li>Enter the VIP IP, which can be found as the cluster IP value in the
                <codeph>~/scratch/cp/my_cloud/stage/info/net_info.yml</codeph> file</li>
            <li>Select the checkbox to skip volume creation</li>
          </ol>
          <note>Wait until the action completes</note>
        </li>
        <li>Modify the <codeph>cinder.conf.j2</codeph> file to update the VSA cluster: <ol>
            <li>On the deployer, change to the following directory: <codeph>cd
              ~/helion</codeph></li>
            <li>Edit the <codeph>/hos/ansible/roles/_CND-CMN/templates/cinder.conf.j2</codeph> file
              as follows: <ol>
                <li>Change the <codeph>enabled_backends</codeph> line to:
                  <codeblock>enabled_backends=vsa-1</codeblock></li>
              </ol></li>
            <li>Copy the VSA section, uncomment it, and fill the values in as seen in the following
              example. Note that the names assigned (in bold) are only examples. Please enter your
              specific values here:
              <codeblock>
<b>hplefthand_password: stack
hplefthand_clustername: hlm003-vsa-cluster
hplefthand_api_url: https://10.241.103.7:8081/lhos
hplefthand_username: stack</b>
hplefthand_iscsi_chap_enabled: true
<b>volume_backend_name: vsa-backend-hlm003</b>
volume_driver: cinder.volume.drivers.san.hp.hp_lefthand_iscsi.HPLeftHandISCSIDriver
hplefthand_debug: false</codeblock></li>
            <li>Run the following commands to commit and deploy the change: <ol>
                <li><codeph>git add -A</codeph></li>
                <li><codeph>git commit -m "your commit message goes here"</codeph></li>
                <li><codeph>cd ~/helion/hos/ansible</codeph></li>
                <li><codeph>ansible-playbook -i hosts/localhost
                  config-processor-run.yml</codeph></li>
                <li><codeph>ansible-playbook -i hosts/localhost ready-deployment.yml</codeph></li>
                <li><codeph>cd ~/scratch/ansible/next/hos/ansible</codeph></li>
                <li><codeph>ansible-playbook -i hosts/verb_hosts
                  cinder-reconfigure.yml</codeph></li>
              </ol></li>
            <li>From the Control Plane, use the Cinder command-line client to create a volume so you
              can verify that VSA is correctly configured. You can delete the created volume
              afterwards, if desired. <ol>
                <li>Create a test volume from a user account and verify that the volume is
                  successfully created in the "available" state:
                  <codeblock>cinder create --display-name &lt;name> &lt;size></codeblock></li>
                <li>Using a session with the admin creds, show the details for the test volume
                  created using: <codeblock>cinder show &lt;volumeId></codeblock> and verify that
                  the volume was created on the correct backend, e.g.
                  <codeblock>os-vol-host-attr:host                                                                         
                  ha-volume-manager@vsa-1#vsa-backend-hlm003</codeblock>
                </li>
                <li>Delete the test volume</li>
              </ol></li>
          </ol>
        </li>
      </ol>
    </section>
  </body>
</topic>
