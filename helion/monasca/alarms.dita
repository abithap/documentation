<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="boldproperty">
  <title>Alarm Definitions</title>
  <shortdesc>List of service-specific alarms and the recommended troubleshooting steps.</shortdesc>
  <refbody>
    <section id="HAProxy">
      <title>HAProxy</title>
      <table frame="all" rowsep="1" colsep="1" id="table_flj_2tl_zs">
        <tgroup cols="4" align="left">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Alarm Name</entry>
              <entry>Description</entry>
              <entry>Likely Cause</entry>
              <entry>Mitigation Tasks to Perform</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Process Check</entry>
              <entry>process_name=haproxy</entry>
              <entry>Haproxy is not running on this machine.</entry>
              <entry>Restart haproxy on the alarming host.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section id="HLinux">
      <title>HLinux</title>
      <table frame="all" rowsep="1" colsep="1" id="table_ik5_3km_zs">
        <tgroup cols="4">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Alarm Name</entry>
              <entry>Description</entry>
              <entry>Likely Cause</entry>
              <entry>Mitigation Tasks to Perform</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>CPU Usage</entry>
              <entry>Alarms on high CPU usage</entry>
              <entry>Heavy load or runaway processes</entry>
              <entry>Log onto the box and diagnose heavy CPU usage.</entry>
            </row>
            <row>
              <entry>Disk Inode Usage</entry>
              <entry>Nearly out of inodes for a partition.</entry>
              <entry>Many files on the disk.</entry>
              <entry>Investigate cleanup of data or migration to other partitions.</entry>
            </row>
            <row>
              <entry>Disk Usage</entry>
              <entry>High Disk usage.</entry>
              <entry>Large files on the disk</entry>
              <entry>Investigate cleanup of data or migration to other partitions.</entry>
            </row>
            <row>
              <entry>Host Status</entry>
              <entry>Alerts when a host is unreachable</entry>
              <entry>Host or network is down</entry>
              <entry>If a single host attempt to restart the box. If multiple investigate network
                issues.</entry>
            </row>
            <row>
              <entry>Memory Usage</entry>
              <entry>High memory usage.</entry>
              <entry>Overloaded system or services with memory leaks</entry>
              <entry>Log onto the system investigate high memory users.</entry>
            </row>
            <row>
              <entry>Network Errors</entry>
              <entry>Alarms on a high network error rate.</entry>
              <entry>Bad network or cabling</entry>
              <entry>Take this system out of service until the network can be fixed.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section id="logging">
      <title>Logging</title>
      <table frame="all" rowsep="1" colsep="1" id="table_gc2_ndh_1t">
        <tgroup cols="5">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <colspec colname="c5" colnum="5" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Alarm Name</entry>
              <entry>Component</entry>
              <entry>Description</entry>
              <entry>Likely Cause</entry>
              <entry>Mitigation Tasks to Perform</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Elasticsearch Unassigned Shards</entry>
              <entry>Elasticsearch</entry>
              <entry>Elasticsearch unassigned shards count &gt; 0</entry>
              <entry>Environment could be misconfigured</entry>
              <entry>
                <ul>
                  <li>If you have unassigned shards, make sure that all servers are at the same
                    version of Elasticsearch.</li>
                  <li>Make sure local (true) is set.</li>
                  <li>You may need to change the number_of_replicas to a different value, then back
                    (e.g. from 2 to 1 and back to 2)</li>
                </ul>
              </entry>
            </row>
            <row>
              <entry>Elasticsearch Field Data Evictions</entry>
              <entry>Elasticsearch</entry>
              <entry>Elasticsearch Field Data Evictions count &gt; 0</entry>
              <entry>Field Data Evictions may be found even though it is nowhere near the limit
                set.</entry>
              <entry>Field Data Evictions may be found even though it is nowhere near the limit set.
                This could be because the maximum cache size specified is split between the
                partitions, so for 16 partitions, any given field data inserted would actually have
                a maximum size of indices.fielddata.cache.size / 16. This value may need to be
                increased.</entry>
            </row>
            <row>
              <entry>Elasticsearch Bulk Pool Rejected</entry>
              <entry>Elasticsearch</entry>
              <entry>Elasticsearch Bulk Pool Rejected count &gt; 0</entry>
              <entry>Thread pool size could be too small.</entry>
              <entry>You may need to increase the threadpool.bulk.queue_size (from 50 to 100, for
                example).</entry>
            </row>
            <row>
              <entry>Elasticsearch Number of Log Entries</entry>
              <entry>Elasticsearch</entry>
              <entry>Elasticsearch Number of Log Entries</entry>
              <entry>The number of log entries may get too large</entry>
              <entry>Kibana may hang if the number of log entries is too large (e.g. above 40,000).
                You may need to keep the page size small enough (about 20,000 results), because if
                it is larger (e.g. 200,000), it may hang the browser.</entry>
            </row>
            <row>
              <entry>Elasticsearch Open File Descriptors </entry>
              <entry>Elasticsearch</entry>
              <entry>Elasticsearch Open File Descriptors &gt; 90%</entry>
              <entry>Configured to allow too many file descriptors to be opened.</entry>
              <entry>Make sure that the limits.conf settings are being used, and adjust them if
                needed. A "ulimit" statement could cause this value to be ignored (overwriting the
                value passed by the ulimit statement).</entry>
            </row>
            <row>
              <entry>Elasticsearch Max Total Indices Size</entry>
              <entry>Elasticsearch</entry>
              <entry>Elasticsearch Total Indices size
                &gt;elasticsearch_max_total_indices_size_in_bytesdefined by user</entry>
              <entry>elasticsearch_max_total_indices_size_in_bytes may be set too low, or you may
                have insufficient resources.</entry>
              <entry>If the total size of all the indices exceeds the size of the
                elasticsearch_max_total_indices_size_in_bytes as you have defined it, you can adjust
                the value if you want to give more space and you have the resources. If not, you may
                need to adjust the Curator to remove indices sooner.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>Elasticsearch</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>If the Elasticsearch process goes down, try restarting it with:
                <codeblock>sudo systemctl restart elasticsearch</codeblock>
              </entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>Logstash</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>If the Logstash process goes down, try restarting it with:
                <codeblock>sudo systemctl restart logstash</codeblock>
              </entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>Beaver</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>If the Logstash process goes down, try restarting it with:
                <codeblock>sudo systemctl restart beaver</codeblock>
              </entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>Apache</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>If the Logstash process goes down, try restarting it with:
                <codeblock>sudo systemctl restart apache2</codeblock>
              </entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>Kibana</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>If the Logstash process goes down, try restarting it with:
                <codeblock>sudo systemctl restart kibana</codeblock>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section id="monasca">
      <title>Monasca</title>
      <table frame="all" rowsep="1" colsep="1" id="table_dry_245_zs">
        <tgroup cols="5">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <colspec colname="c5" colnum="5" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Alarm Name</entry>
              <entry>Component</entry>
              <entry>Description</entry>
              <entry>Likely Cause</entry>
              <entry>Mitigation Tasks to Perform</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>HTTP Status</entry>
              <entry>persister</entry>
              <entry>Persister Health Check</entry>
              <entry>The process has crashed or a dependency is out.</entry>
              <entry>If the process has crashed, restart. If a dependent service is down, address
                that issue.</entry>
            </row>
            <row>
              <entry>HTTP Status</entry>
              <entry>api</entry>
              <entry>API Health Check</entry>
              <entry>The process has crashed or a dependency is out.</entry>
              <entry>If the process has crashed, restart. If a dependent service is down, address
                that issue.</entry>
            </row>
            <row>
              <entry>Kafka Consumer Lag</entry>
              <entry>Kafka</entry>
              <entry>Consumers are falling behind for a particular Kafka topic.</entry>
              <entry>There is a slow down in the system or heavy load.</entry>
              <entry>Look for high load in the various systems. This alert can fire for multiple
                topics or on multiple hosts. Which alarms are firing can help diagnose likely
                causes, ie if all on one machine it could be the machine. If one topic across
                multiple machines it is likely the consumers of that topic, etc.</entry>
            </row>
            <row>
              <entry>Monasca Agent Collection Time</entry>
              <entry>monasca-agent</entry>
              <entry>The time the agent took to collect metrics.</entry>
              <entry>Heavy load on the box or a stuck agent plugin.</entry>
              <entry>Address load issue on the machine. If needed restart the agent.</entry>
            </row>
            <row>
              <entry>Monasca Agent Emit Time</entry>
              <entry>monasca-agent</entry>
              <entry>The time the agent took to send metrics to the Monasca API.</entry>
              <entry>API or the network is slow.</entry>
              <entry>Check the network graphs and look for indication of networks issues. If coming
                from most boxes it is possibly api problems.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>Kafka</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>notification</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>storm</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>zookeeper</entry>
              <entry>Process not running.</entry>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Zookeeper Latency</entry>
              <entry>zookeeper</entry>
              <entry>Zookeeper is experiencing high latency.</entry>
              <entry>Heavy system load.</entry>
              <entry>Check the individual system as well as activity across the entire
                service.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section id="mysql"><title>MySQL</title>
      <table frame="all" rowsep="1" colsep="1" id="table_ft3_bp5_zs">
        <tgroup cols="4">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Alarm Name</entry>
              <entry>Description</entry>
              <entry>Likely Cause</entry>
              <entry>Mitigation Tasks to Perform</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>MySQL Slow Query Rate</entry>
              <entry>MySQL is reporting many slow queries.</entry>
              <entry>System load.</entry>
              <entry>This could be an indication of near capacity limits or an exposed bad query.
                First, check overall system load and then investigate MySQL details.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>Alarms when MySQL process is not found.</entry>
              <entry>MySQL crashed.</entry>
              <entry>Restart MySQL on the affected node.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section id="nova">
      <title>Nova</title>
      <table frame="all" rowsep="1" colsep="1" id="table_bv5_q2h_1t">
        <tgroup cols="5">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <colspec colname="c5" colnum="5" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Alarm Name</entry>
              <entry>Component</entry>
              <entry>Description</entry>
              <entry>Likely Cause</entry>
              <entry>Mitigation Tasks to Perform</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Process Check</entry>
              <entry>nova-api</entry>
              <entry/>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>HTTP Status</entry>
              <entry>nova-api</entry>
              <entry>API health check</entry>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>nova-cert</entry>
              <entry/>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>nova-compute</entry>
              <entry/>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>nova-conductor</entry>
              <entry/>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>nova-consoleauth</entry>
              <entry/>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>nova-novncproxy</entry>
              <entry/>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Check</entry>
              <entry>nova-scheduler</entry>
              <entry/>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>Process Bound Check</entry>
              <entry>nova-api</entry>
              <entry>process_name=nova-api. Check that the number of processes found is in a
                predefined range</entry>
              <entry>Process crashed or too many processes running</entry>
              <entry>Stop all the processes and restart nova-api process. Review system and nova-api
                logs.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
    <section id="rabbitmq">
      <title>RabbitMQ</title>
      <table frame="all" rowsep="1" colsep="1" id="table_rsb_mp5_zs">
        <tgroup cols="4">
          <colspec colname="c1" colnum="1" colwidth="1.0*"/>
          <colspec colname="c2" colnum="2" colwidth="1.0*"/>
          <colspec colname="c3" colnum="3" colwidth="1.0*"/>
          <colspec colname="c4" colnum="4" colwidth="1.0*"/>
          <thead>
            <row>
              <entry>Alarm Name</entry>
              <entry>Description</entry>
              <entry>Likely Cause</entry>
              <entry>Mitigation Tasks to Perform</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Process Check</entry>
              <entry>rabbitmq-server process not running</entry>
              <entry>Process crashed.</entry>
              <entry>Restart process on affected node. Review logs.</entry>
            </row>
            <row>
              <entry>RabbitMQ Queue Depth</entry>
              <entry>Alarms when the depth of the message queue is high.</entry>
              <entry>System load or a slow/failed consumer.</entry>
              <entry>Look for high load in the system. This alarm can fire for multiple queues and
                multiple machines. Which ones it fired on can indicate the cause. If only a single
                queue is slowing, the cause could be that the consumer is down.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
  </refbody>
</reference>
