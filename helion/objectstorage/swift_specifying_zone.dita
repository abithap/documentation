<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_szk_rjb_pt">
  <title>Specifying Swift Zones</title>
  <body>
    <p>In Swift, drives are associated with a zone. When drives are in different zones, the
      swift-ring-builder program will, as far as possible, place replicas in different zones. Since
      the replicas are in different zones, you know that if all drives in a zone are failed, that
      there must be some replicas remaining in other zones. For example, if you have three zones and
      one is failed, there will be a replica in each of the remaining zones.</p>
    <p>You do not need to have the same number of zones as the replica count. For example, with a
      replica count of 3 and two zones, for any given partition, two replicas are located in one
      zone and one replica is located in the other zone. IIn addition, you may have more zones than
      replicas. For example, with a replica count of 3 and 6 zones, for any given partition, there
      will be a replica in 3 of the zones and no replica in the other 3 zones. A single zone is also
      possible. In this mode, assuming you have many servers, Swift will ensure that replica are
      located on different servers so that failure of any given server will not cause the object to
      be inaccessible.</p>
    <p>Swift zones come at a cost for the following reasons:<ul id="ul_zxm_xjb_pt">
        <li>To balance the partitions correctly across the available drives and servers, you must
          have the same number of drives in each zone (or more accurately, the same capacity in each
          zone). In practice this means than when you expand your system, you must add servers to
          each zone. For example, if you have 3 zones, the smallest number of servers you can add at
          any time is 3 – even if you only needed a fraction of the additional storage to meet your
          growth demands. With a single zone, you could add a single server.</li>
        <li>To be useful, the zone layout should correspond to infrastructure in your data center
          that supports high availability. There is little point in using multiple zones if all
          servers are connected to a single network switch. A failure of that switch makes all data
          inaccessible.</li>
        <li>It can be difficult to change the zone layout. You cannot move a drive between zones –
          instead you add drives in a new zone and then remove the original drives. This is a time
          consuming and tedious process.</li>
      </ul></p>
    <p>In Helion Openstack, the default is to use a single zone. You may specify zones using the
      swift-zones attribute in the ring-specifications part of the input model (usually in
      data/swift/rings.yml). The swift-zones attribute can be specified in the following ways:<ul
        id="ul_ztr_fkb_pt">
        <li>Omitted. In this case, the default is to use a single zone</li>
        <li>Specified at the region level in ring-specifications. This means that the zone layout
          applies to all rings in the region.</li>
        <li>Specified at the ring level in ring-specifications. This means that zone layout applies
          to this ring only – overriding a swift-zones attribute specified at the region level</li>
      </ul></p>
    <p>The swift-zones attribute has the following syntax. It uses the rack ids. For example, if you
      have 6 racks in your data center and wish to have 3 zones, you would specify the layout as
      follows:<codeblock>swift-zones:
  - id: 1
    rack-ids:
      - 1
      - 2
  - id: 2
    rack-ids:
      - 3
      - 4
  - id: 3
      - 5
      - 6</codeblock></p>
    <p>As you can see, rack 1 and 2 are in zone 1, rack 3 and 4 are in zone 2, etc.</p>
    <p>Once you deploy a system using this layout, you cannot change the zone layout for the
      existing servers. The only way to change the layout is to add additional racks and place them
      in a zone and then drain some of servers in the original racks from the ring. This moves data
      off the original racks and onto the new racks. Once this is complete, you can then remove the
      servers. At this stage you can re-use these servers by adding them to your remaining
      zones.</p>
    <p>Swift has an additional concept that controls layout and placement of data. This is the swift
      region concept. This is similar in nature to zones, but is used to manage distribution and
      placement of replicas in different data centers. In HOS 2.0 this feature is not supported.</p>
  </body>
</topic>
