<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_gmc_dgk_jt">
  <title> VSA Configuration (Optional)</title>
  <body>
    <p>This page provides detailed instructions on deployment of HP StoreVirtual Appliance (VSA)
      Storage Nodes, and their configuration as Cinder backend.</p>
    <section>
      <title id="preq">Prerequisite</title>
      <p>
        <ul id="ul_pfl_bbz_ht">
          <li>HP Helion Cloud must be successfully deployed. It should be up and running.</li>
          <li>Remember to note down the IP address of  VSA VM and VSA Cluster from
              <codeph>net_info.yml</codeph> file, which is generated by configuration
            processor.<!-- (It is recommended that you write down the IP address so that it can be easily accessible).--></li>
        </ul>
      </p>
    </section>
    <section>
      <title>Installing VSA and CMC</title>
      <p>Perform the following steps to deploy VSA and CMC:<ol id="ol_wgh_djk_jt">
          <li>Login to deployer node.</li>
          <li>Execute the following command to install VSA:
              <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts vsa-deploy.yml</codeblock><p>Once
              VSA is successfully deployed then you can execute the ansible playbook to install CMC.
              CMC is required to configure the HP StoreVirtual VSA nodes </p></li>
          <li>Execute the following command to install
            CMC:<codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts cmc-deploy.yml</codeblock></li>
        </ol><b> Install (any) X Display Mechanism to Launch Centralized Management Console
          (CMC)</b></p>
      <p>You must configure X display tool to launch CMC. User can select <b>any</b> X display tool.
        In this section we are using <b>Xming</b> tool as an example to launch CMC. The following
        example provides the steps to install Xming and launch CMC.</p>
      <p><!--You must configure X display to launch CMC. Therefore, CMC is required to configure the HP StoreVirtual VSA nodes. In this section we are referring to Xming as a X display tool. The display tool can vary from one user to another.--></p>
      <p><!--The follwowing steps provide an example on the configuration of Xming to launch CMC.--></p>
      <p><!--In order to configure the HP StoreVirtual VSA nodes, you must first install the CMC. The following example provides the steps for installaing CMC. The Xming is a tool we are referring in the example below-->.</p>
      <p>
        <ol id="ol_alr_mdl_jt">
          <li>Install <b>Xming</b> on Windows Box from where you can access the deployer node.</li>
          <li>Select <b>Enable X11 forwarding</b> check box on the putty session for deployer node. </li>
          <li>SSH to first control plane node.<codeblock>ssh -X</codeblock></li>
          <li>Execute the following command:
            <codeblock>/opt/HP/StoreVirtual/UI/jre/bin/java -jar /opt/HP/StoreVirtual/UI/UI.jar</codeblock>CMC
            will be launch successfully.</li>
        </ol>
      </p>
    </section>
    <section>
      <title>Creating a StoreVirtual Cluster and adding it to a new Management GroupCluster using
        CMC</title>
      <!--<p><note type="important"><?oxy_custom_start type="oxy_content_highlight" color="255,255,0"?>Ensure that CMC is installed successfully and HP StoreVirtual VSA (one or more) is deployed in the same management network where CMC is installed.<?oxy_custom_end?></note></p>-->
      <p>Perform the following steps to create the cluster.<ol id="ol_yln_fhl_jt">
          <li>Open CMC.<p>By default, the CMC is configured to discover the StoreVirtual nodes in
              the subnet in which it is installed. You can manually add the nodes also.</p></li>
          <li>In the CMC UI, click <b>Find</b> and then click <b>Find Systems</b> from the left
            panel. Find Systems dialogue box is displayed.</li>
          <li>You can choose <b>Add</b> or <b>Find</b> option to search the system. Find option
            starts searching for the nodes in the same subnet as that of CMC. Add option displays an
              <b>Enter IP</b> pop-up box to enter the IP of the StoreVirtual system.</li>
          <li>In the CMC UI, click <b>Tasks</b> then point to <b>Management Group</b> and click<b>
              New Management Group</b>.</li>
          <li>In the <b>New Management Group Name</b> box, enter a name for the management group.
            For example: <codeph>hlm003-vsa-mg</codeph></li>
          <li>Click <b>Next</b> to display the Add Administrative User page.</li>
        <li>Enter the required information (username/password) for the Administrative User.<p>For
              example:</p><ul id="ul_cdk_xjl_jt">
              <li>username- stack </li>
              <li>password-stack</li>
            </ul></li>
          <li>Click <b>Next</b> to display the Management Group Time page. </li>
          <li>Add NTP server information and click <b>Next</b> to display the Domain Name Server
            Configuration page.</li>
          <li>Skip the DNS and SMTP sections.</li>
          <li>Click <b>Next</b> to display a Wizard in the Create a Cluster page.</li>
          <li>Select the cluster type as <i>Standard Cluster</i> from the displayed options and
            click <b>Next</b>.</li>
          <li>In the <b>Cluster Name</b> box, enter the name of the cluster and click <b>Next</b>.
            For example: <codeph>hlm003-vsa-cluster</codeph>.</li>
          <li>In the Add VIP and Subnet Mask pop-up box, enter the virtual IP and Subnet Mask of the
            cluster in the respective boxes and click <b>OK</b>. The details are displayed in a
            tabular format in the page. <note>The VIP IP can be found as the cluster IP value in the
                <codeph>~helion/my_cloud/stage/info/net_info.yml</codeph> file.</note></li>
          <li>(Optional) Click the checkbox displayed against <b>Skip Volume Creation</b>.</li>
          <li>Click <b>Next</b>.The Management Group and Cluster is created and displays in the Home
            page of CMC.<p>Wait till the cluster is displayed in the Home Page of CMC.</p></li>
        </ol></p>
    </section>
    <section>
      <title>Configure VSA as a Cinder Backend</title>
      <p>You must modify <codeph>cinder.conf.j2</codeph> to update VSA cluster.</p>
      <p>Perform the following steps to update the VSA cluster:<ol id="ol_dj2_qcz_ht">
          <li>Login to deployer node.</li>
          <li>Change the directory as shown below:<codeblock>cd ~/helion</codeblock></li>
          <li>Edit <codeph>cinder.conf.j2</codeph> file at
              <codeph>hos/ansible/roles/_CND-CMN/templates/cinder.conf.j2</codeph> to add VSA data
            as follows:<codeblock>enabled_backends=vsa-1</codeblock></li>
          <li>Copy VSA section, uncomment it, and modify the values in the
              <codeph>cinder.conf.j2</codeph> file as shown in the following
              example:<codeblock>[vsa-1]
hplefthand_password: stack
hplefthand_clustername: hlm003-vsa-cluster
hplefthand_api_url: https://10.241.103.7:8081/lhos
hplefthand_username: stack
hplefthand_iscsi_chap_enabled: true
volume_backend_name: vsa-backend-hlm003
volume_driver: cinder.volume.drivers.san.hp.hp_lefthand_iscsi.HPLeftHandISCSIDriver
hplefthand_debug: false</codeblock><note>
              Please enter the parameter values which are specific to your environment. </note></li>
          <li>Commit your configuration to a <xref href="../../using_git.dita#topic_u3v_1yz_ct"
              >local
              repository</xref>:<codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "&lt;commit message>"</codeblock><note>
              Enter your commit message &lt;commit message></note></li>
          <li>Run the configuration
            processor:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
          <li>Change the directory to <codeph>~/scratch/ansible/next/hos/ansible</codeph> and run
            the following command to create a deployment
            directory.<codeblock><codeph>ansible-playbook -i hosts/localhost ready-deployment.yml</codeph></codeblock></li>
        </ol></p>
    </section>
    <p id="run-ceph-client-package"><b>Run Cinder Reconfigure Packages</b></p>
    <p>Execute the following command to configure VSA. </p>
    <p>
      <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts cinder-reconfigure.yml</codeblock>
    </p>
    <section>
      <title>Create Volume Type to Verify the Configuration of VSA</title>
      <p>You must create a volume to verify the configuration of  VSA. Once you are able to create
        the volume then delete the created volume.</p>
      <p>Perform the following steps to create a volume using Horizon dashboard:</p>
      <p>
        <ol id="ol_ldf_fxc_gt">
          <li>Log into the Horizon dashboard as <b>Admin</b>. The Horizon dashboard displays with
            the options in the left panel.</li>
          <li>From the left panel, click the <b>Admin</b> tab and then click the <b>Volumes</b> tab
            to display the Volumes page.<image href="../../../media/vsa/create-volumetype.png"
              id="image_mfk_mlq_jt"/></li>
          <li>Click <b>Create Volume Type</b> to display a dialog box.<p><image
                href="../../../media/vsa/create-volumetype1.png" id="image_ub1_4lq_jt"/></p></li>
          <li>Enter a unique name for the volume. </li>
          <li>Click<b> Create Volume Type</b> to complete the action. Clicking <b>Cancel</b> returns
            to the Volumes screen without completing the action.<image
              href="../../../media/vsa/create-volumetype2.png" id="image_ink_rlq_jt"/><p>The newly
              created volume displays in the Volumes page.</p></li>
        </ol>
      </p>
    </section>
    <section id="associate-volume-backend">
      <title>Associate the volume type to a backend</title>
      <p>To map a volume type to a backend, do the following: <ol id="ol_owv_krv_3t">
          <li>Login to the Horizon dashboard. The Horizon dashboard displays with the options in the
            left panel.</li>
          <li>From the left panel, click the <b>Admin</b> tab and then click the <b>Volumes</b> tab
            to display the Volumes page.<image href="../../../media/vsa/create-volumetype2.png"
              id="image_cvw_1my_jt"/></li>
          <li>Click <b>View Extra Specs</b> displayed against the volume type which you want to
            associate to the backend. <image
              href="../../../media/vsa/create-volumetype2_extra-spec.png" id="image_edj_fmq_jt"
              /><p>The <b>Create Volume Type Extra Specs</b> dialog box displays. Now map the volume
              type to the associate backend.</p><p><image
                href="../../../media/vsa/volume-extra-specs.png" id="image_xz3_lmq_jt"/></p></li>
          <li>In the <b>Key</b> box, enter <i>volume_banked_name</i> as volume backend name. This is
            the name of the key used to specify the storage backend when provisioning volumes of
            this volume type. The volume backend name must match the backend name mentioned in the
              <codeph>cinder.conf</codeph> file. For example: <i>vsa-backend-hlm003</i></li>
          <li>In the <b>Value</b> box, enter the name of the backend to which you want to associate
            the volume type. For Example: <i>vsa_storage</i></li>
          <li>Click <b>Create</b> to create the extra volume type specs. <note> Once the volume type
              is mapped to the backend, you can create volumes with this volume type.</note>Now you
            can login as a user and create a volume.</li>
        </ol></p>
    </section>
    <section>
      <title>Create Volume from User Account</title>
      <p>Perform the following steps to create a volume using Horizon dashboard. <ol
          id="ol_syw_xw3_jt">
          <li>Log into the Horizon dashboard. The Horizon dashboard displays with the options in the
            left panel. </li>
          <li>From the left panel, click the <b>Project</b> tab and then click the <b>Volumes</b>
            tab to display the Volumes page.<image href="../../../media/vsa/user-create-vol1.png"
              id="image_jh2_tnq_jt"/></li>
          <li>Click <b>Create Volume</b> to display a dialog box.<image
              href="../../../media/vsa/user_create-volume.png" id="image_whm_xnq_jt"/></li>
          <li>Enter the required details in the corresponding fields. </li>
          <li>Click<b> Create Volume </b> to complete the action. Clicking <b>Cancel</b> returns to
            the Volumes screen without completing the action.<image
              href="../../../media/vsa/user-create-vol-main.png" id="image_sds_14q_jt"/><p>The
              volume is successfully created and the status of the volume is available.</p></li>
        </ol></p>
    </section>
    <section>
      <title>Delete Volume from User Account</title>
      <p>Perform the following steps to delete a volume using Horizon dashboard:</p>
      <p>
        <ol id="ol_sdl_vy3_jt">
          <li>Log into the Horizon dashboard. The Horizon dashboard displays with the options in the
            left panel. </li>
          <li>From the left panel, click the <b>Project</b> tab and then click the <b>Volumes</b>
            tab to display the Volumes page.<image
              href="../../../media/vsa/user-create-vol-main.png" id="image_tch_3pq_jt"/></li>
          <li>Check the box in the row of the volume to delete.</li>
          <li>Click <b>Delete Volume</b> to display the dialog box.<image
              href="../../../media/vsa/user-delete-vol.png" id="image_hpt_z4q_jt"/></li>
          <li>Click <b>Delete the Volume</b> to confirm the deletion of the selected volume. To exit
            without deleting the volume and to close the screen, click <b>Cancel</b> before
            deleting.</li>
        </ol>
      </p>
    </section>
    <note type="important"> You can create more than one VSA cluster of same or different type by
      specifying the configuration in cloud model. For more details, refer <xref
        href="vsa_create_multiple_clusters.dita#topic_q3v_krq_jt">Modifying Cloud Model to Create
        Multiple Clusters</xref>.</note>
  </body>
</topic>
