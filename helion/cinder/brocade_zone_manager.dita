<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_msm_b1j_jt">
  <title>Brocade Fibre Channel Zone Manager </title>
  <body>
    <p>This page describes the configuration of Brocade Fibre Channel Zone Manager for the block
      storage.<!--. The Block Storage is configured to use a Fibre Channel Volume Driver that supports Zone Manager. --></p>
    <section>
      <title id="preq">Prerequisite</title>
      <p>
        <ul id="ul_pfl_bbz_ht">
          <li>HP Helion Cloud must be successfully deployed. It should be up and running.</li>
          <li>Brocade switches must be available in the cloud management network.</li>
          <li>
            <p>Block Storage should be configured to use a Fibre Channel Volume Driver that supports
              Zone Manager. To enable Fibre Channel Zone Manager, you require the following
                <codeph>cinder.conf</codeph> configuration options. </p>
          </li>
        </ul>
      </p>
    </section>
    <section>
      <title>Configure Brocade Fibre Channel Zone Manager </title>
      <p>You must modify <codeph>cinder.conf.j2</codeph> to update Brocade Fiber Channel Zone
        Manager Driver details.</p>
      <p>Perform the following steps to configure brocade fibre channel zone manager:<ol
          id="ol_dj2_qcz_ht">
          <li>Login to deployer node.</li>
          <li>Change the directory as shown below:<codeblock>cd ~/helion</codeblock></li>
          <li>Edit <codeph>cinder.conf.j2</codeph> file at
              <codeph>/home/stack/helion/my_cloud/config/cinder</codeph> to add Brocade Fiber
            Channel Zone Manager Driver data. <note>
              <ul id="ul_ghm_zbj_jt">
                <li>The values entered in step <b>4</b> is an example. You must change the value as
                  per your requirement/environment.</li>
                <li> To enable FCZM you must add <codeph>zoning_mode=fabric</codeph> to
                    [<b>DEFAULT</b>] entry. </li>
                <li>Brocade driver information is a new section added to the [fc-zone-manager]
                  section. Fabric switch [<b>Fabric_A</b>] [<b>Fabric_B</b>] information is added in
                    [<b>device</b>] section for each side of the fabric.</li>
              </ul>
            </note></li>
          <li>Copy the following configuration.
              <codeblock>[DEFAULT] 
zoning_mode=fabric 

[fc-zone-manager] 
brcd_sb_connector=cinder.zonemanager.drivers.brocade.brcd_fc_zone_client_cli.BrcdFCZoneClientCLI fc_san_lookup_service=cinder.zonemanager.drivers.brocade.brcd_fc_san_lookup_service.BrcdFCSanLookupService zone_driver=cinder.zonemanager.drivers.brocade.brcd_fc_zone_driver.BrcdFCZoneDriver 
fc_fabric_names=FABRIC_A, FABRIC_B 

[FABRIC_A] 
fc_fabric_address = 10.10.0.20 
fc_fabric_user = admin 
fc_fabric_password = password
 principal_switch_wwn = 10:00:50:eb:1a:05:c5:5d 
zoning_policy = initiator-target
fc_fabric_port = 22
zone_activate = true 
zone_name_prefix = FABRIC_A_

[FABRIC_B] 
fc_fabric_address = 10.10.0.21 
fc_fabric_user = admin 
fc_fabric_password = password
 principal_switch_wwn = 10:00:50:eb:1a:05:c5:5e
zoning_policy = initiator-target
fc_fabric_port = 22
zone_activate = true 
zone_name_prefix = FABRIC_B_</codeblock><note>Please
              enter the values which are specific to your environment. </note></li>
          <li>Commit your configuration to a <xref href="../using_git.dita#topic_u3v_1yz_ct">local
              repository</xref>:<codeblock>cd ~/helion/hos/ansible
git add -A
git commit -m "&lt;commit message>"</codeblock><note>
              Enter your commit message &lt;commit message></note></li>
          <li>Run the configuration
            processor:<codeblock>cd ~/helion/hos/ansible
ansible-playbook -i hosts/localhost config-processor-run.yml</codeblock></li>
          <li>Change the directory to <codeph>~/scratch/ansible/next/hos/ansible</codeph> and run
            the following command to create a deployment
            directory.<codeblock><codeph>ansible-playbook -i hosts/localhost ready-deployment.yml</codeph></codeblock></li>
        </ol></p>
    </section>
    <p id="run-ceph-client-package"><b>Run Cinder Reconfigure Packages</b></p>
    <p>Execute the following command to configure brocade zone manager. </p>
    <p>
      <codeblock>cd ~/scratch/ansible/next/hos/ansible
ansible-playbook -i hosts/verb_hosts cinder-reconfigure.yml</codeblock>
    </p>
    <p>Now, attach volume to verify the configuration of Fibre channel Zone Manager. You must first
      create a volume before attaching to an instance, as detailed in <xref
        href="verify_backend_configuration.dita#topic_q5q_trz_jt/create-volume">create a
        volume</xref>. </p>
    <section>
      <title>Attach Volume to an Instance</title>
      <p>Perform the following steps to attach a volume to an instance:<ol id="ol_myj_2jj_jt">
          <li>Log into the Horizon dashboard. The Horizon dashboard displays with the options in the
            left panel. </li>
          <li>From the left panel, click the <b>Project</b> tab and then click the <b>Volumes</b>
            tab to display the Volumes page.</li>
          <li>Click the check box next to the name of the volume you want to attach. </li>
          <li>In the Action column, click <b>Edit Attachments</b> The Manage Volume Attachments
            screen is displayed.</li>
          <li>.In the <b>Attach To Instance</b> drop-down, select the instance that you want to
            attach to the volume. </li>
          <li> Edit the <b>Device Name</b> if necessary.</li>
          <li>Click <b>Attach Volume</b> to complete the action. Clicking <b>Cancel</b> returns to
            the Volumes screen without completing the action. </li>
          <li>Verify that the volume you attached is displayed in the Attached To columns on the
            Volumes screen.<p> Zones are created and activated in switch effective configuration
              after the successful attachment of volume to an instance.</p></li>
        </ol></p>
    </section>
    <section>
      <title>Detach Volume from Instance</title>
      <p>Perform the following steps to detach the volume from instance:<ol id="ol_edq_pkj_jt">
          <li>Log into the Horizon dashboard. The Horizon dashboard displays with the options in the
            left panel. </li>
          <li>From the left panel, click the <b>Project</b> tab and then click the <b>Volumes</b>
            tab to display the Volumes page.</li>
          <li>Click the check box next to the name of the volume you want to attach. </li>
          <li>In the Action column, click <b>Edit Attachments</b> The Manage Volume Attachments
            screen is displayed.</li>
          <li>Click <b>Detach Attachment</b>. A confirmation dialog box appears.</li>
          <li>Click <b>Detach Attachment</b> to confirm the detachment of the volume from the
            associated instance. Clicking <b>Cancel</b> returns to the Volumes screen without
            completing the action.<p>When you dettach the last volume from an instance running on
              the compute host, zones are deleted and removed from the effective
            configuration.</p></li>
        </ol></p>
    </section>
    <section>
      <title>Delete Volume </title>
      <p>Perform the following steps to delete a volume using Horizon dashboard:<ol
          id="ol_adc_wkj_jt">
          <li>Log into the Horizon dashboard. The Horizon dashboard displays with the options in the
            left panel. </li>
          <li>From the left panel, click the <b>Project</b> tab and then click the <b>Volumes</b>
            tab to display the Volumes page.</li>
          <li>Check the box in the row of the volume to delete.</li>
          <li>Click <b>Delete Volume</b> to display the dialog box.</li>
          <li>Click <b>Delete the Volume</b> to confirm the deletion of the selected volume. To exit
            without deleting the volume and to close the screen, click <b>Cancel</b> before
            deleting.</li>
        </ol></p>
    </section>
    <section>
      <title>Known Limitations:</title>
      <p>Following are the known limitation for this release:<ol id="ol_bjg_vnj_jt">
          <li><xref href="https://bugs.launchpad.net/cinder/+bug/1486613" format="html"
              scope="external">https://bugs.launchpad.net/cinder/+bug/1486613</xref> - Existing
            volume detach fails after modifying the zoning_mode=fabric from
                none.<p><b>Workaround</b><ol id="ol_q32_znj_jt">
                <li> Detach all volumes from host that were pre-zoned.</li>
                <li>Delete the pre-defined zone(s) from the fabric</li>
                <li>Enable FCZM</li>
                <li>Reattach all volumes</li>
              </ol></p></li>
          <li><xref href="https://bugs.launchpad.net/cinder/+bug/1486606" format="html"
              scope="external">https://bugs.launchpad.net/cinder/+bug/1486606</xref> - Parallel
            volume attach to different compute host fails</li>
        </ol></p>
    </section>
  </body>
</topic>
