<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_ifg_n33_bt">
  <title>LDAP Integration</title>
  <body>
    <section><title>Integrating with an external LDAP server</title>
      <p>If your organization, like most, uses an LDAP directory service such as Active Directory, you can integrate it with Keystone by following the steps outlined below. </p>
      <ol>
        <li>Ensure that the <b>domain_specific_drivers_enabled</b> option is set to <b>True</b> in
          the main configuration file template
          (<b>roles/KEY-API/templates/keystone.conf.j2</b>).</li>
        <li>Create a YAML file that contains the definition of the LDAP server connection. Use
            <b>roles/KEY-API/files/samples/keystone_configure_ldap_sample.yml</b> as an example.
          Save the file, as, for example, /tmp/myldap.yml. Please refer to the LDAP section of the
          Keystone Kilo documentation for a full list of options and descriptions: <xref
            href="http://docs.openstack.org/kilo/config-reference/content/keystone-configuration-file.html"
            format="html" scope="external"
            >http://docs.openstack.org/kilo/config-reference/content/keystone-configuration-file.html</xref></li>

        <li>Run the reconfiguration playbook, passing the YAML file created in the previous step as
          a command-line option:
          <codeblock>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml -e@/tmp/myldap.yml
</codeblock></li>
        <li>Ensure that the new domain was created for LDAP (Microsoft Active Directory in this
          example), and that user and group records can be retrieved: <codeblock># Import environment variables suited for Keystone administration
$ source keystone.osrc
 
# Get list of domains
stack@hLinux:~$ openstack domain list
+----------------------------------+---------+---------+----------------------------------------------------------------------+
| ID                               | Name    | Enabled | Description                                                          |
+----------------------------------+---------+---------+----------------------------------------------------------------------+
| 6740dbf7465a4108a36d6476fc967dbd | heat    | True    | Owns users and projects created by heat                              |
| default                          | Default | True    | Owns users and tenants (i.e. projects) available on Identity API v2. |
| b2aac984a52e49259a2bbf74b7c4108b | ad      | True    | Dedicated domain for users managed by Microsoft AD server            |
+----------------------------------+---------+---------+----------------------------------------------------------------------+
 
# Get list of LDAP groups
stack@hLinux:~$ openstack group list --domain ad
+------------------------------------------------------------------+------------+
| ID                                                               | Name       |
+------------------------------------------------------------------+------------+
| 03976b0ea6f54a8e4c0032e8f756ad581f26915c7e77500c8d4aaf0e83afcdc6 | testgroup1 |
| 7ba52ee1c5829d9837d740c08dffa07ad118ea1db2d70e0dc7fa7853e0b79fcf | testgroup2 |
+------------------------------------------------------------------+------------+
 
# Get user record
stack@hLinux:~$ openstack user show testuser1 --domain ad
+-----------+------------------------------------------------------------------+
| Field     | Value                                                            |
+-----------+------------------------------------------------------------------+
| domain_id | b2aac984a52e49259a2bbf74b7c4108b                                 |
| id        | 05f107e4b1645c52c24a529e3fb464647e4075a31db3e51b34e1ed41116d7706 |
| name      | testuser1                                                        |
+-----------+------------------------------------------------------------------+
 
# Grant testuser1 admin role within LDAP domain. For demonstration purpose only - don't do this in production!
# Please note that due to current Openstack CLI limitation, we have to use user ID rather then user name
# when working with non-default domain.
stack@hLinux:~$ openstack role add admin --user 05f107e4b1645c52c24a529e3fb464647e4075a31db3e51b34e1ed41116d7706 --domain ad
stack@hLinux:~$ openstack role assignment list --user 05f107e4b1645c52c24a529e3fb464647e4075a31db3e51b34e1ed41116d7706 --domain ad
+----------------------------------+------------------------------------------------------------------+-------+---------+----------------------------------+
| Role                             | User                                                             | Group | Project | Domain                           |
+----------------------------------+------------------------------------------------------------------+-------+---------+----------------------------------+
| c0b1ee04cd0c44c4bf001da9585b107e | 05f107e4b1645c52c24a529e3fb464647e4075a31db3e51b34e1ed41116d7706 |       |         | b2aac984a52e49259a2bbf74b7c4108b |
+----------------------------------+------------------------------------------------------------------+-------+---------+----------------------------------+

</codeblock>
          <note>The LDAP domain is read-only. This means that you cannot create a new user or group
            record in it. </note>
        </li>
        <li>Once an LDAP user is granted the appropriate role, he or she can authenticate within the
          specified domain by setting the appropriate OS_* environment variables for the OpenStack
          CLI.</li>
      </ol>
    </section>
    <section><title>Adjusting WSGI and logging parameters</title> To modify Web Server Gateway
      Interface (WSGI) parameters (such as process counts for public and admin Keystone interfaces)
      and log levels: <ol>
        <li>Adjust respective parameters in
            <b>roles/keystone-common/vars/keystone_deploy_config.yml</b>.</li>
        <li>Run reconfiguration playbook:
          <codeblock>ansible-playbook -i hosts/verb_hosts keystone-reconfigure.yml</codeblock>
        </li>
      </ol>
    </section>
  </body>
</topic>
